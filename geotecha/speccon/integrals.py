# geotecha - A software suite for geotechncial engineering
# Copyright (C) 2013  Rohan T. Walker (rtrwalker@gmail.com)
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see http://www.gnu.org/licenses/gpl.html.
"""integrals and eigenvalues for consolidation using spectral methods
    
"""

from __future__ import division, print_function
import numpy as np
import numbers
from geotecha.piecewise.piecewise_linear_1d import segment_containing_also_segments_less_than_xi
from geotecha.piecewise.piecewise_linear_1d import segments_between_xi_and_xj

def m_from_sin_mx(i, boundary=0):
    """Sine series eigenvalue of boundary value problem on [0, 1]
    
    
    `i` th eigenvalue, M,  of f(x) = sin(M*x) that satisfies:
        f(0) = 0, f(1) = 0; for `boundary` = 0 i.e. PTPB
        f(0) = 0; f'(1) = 0; for `boundary` = 1 i.e. PTIB
        
    Parameters
    ----------
    i : ``int``
        eigenvalue  in series to return
    boundary : {0, 1}, optional
        boundary condition. 
        For 'Pervious Top Pervious Bottom (PTPB)', boundary = 0
        For 'Pervious Top Impervious Bottom (PTIB)', boundary = 1
         
    Returns
    -------
    out : ``float``
        returns the `i` th eigenvalue
        
    """    
    from math import pi    
    
    if boundary not in {0, 1}:
        raise ValueError('boundary = %s; must be 0 or 1.' % (boundary))
        
    return pi * (i + 1 - boundary / 2.0)
    
def dim1sin_af_linear(m, at, ab, zt, zb):
    """Create matrix of spectral integrations
        
    Performs integrations of `sin(mi * z) * a(z) * sin(mj * z)` between [0, 1]
    where a(z) is a piecewise linear function of z.  Calulation of integrals 
    is performed at each element of a square symmetric matrix (size depends 
    on size of `m`)
            
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer        
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
             
    Returns
    -------
    A : numpy.ndarray
        returns a square symmetric matrix, size determined by size of `m`
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter
    geotecha.integrals_generate_code.dim1sin_af_linear : use sympy 
    to perform the integrals symbolically and generate expressions for 
    this function
    
    Notes
    -----
    The `dim1sin_af_linear` matrix, :math:`A` is given by:          
        
    .. math:: \\mathbf{A}_{i,j}=\\int_{0}^1{{a\\left(z\\right)}{sin\\left({m_j}z\\right)}{sin\\left({m_i}z\\right)}\,dz}
    
    where :math:`a\\left(z\\right)` in one layer is given by:
        
    .. math:: a\\left(z\\right) = a_t+\\frac{a_b-a_t}{z_b-z_t}\\left(z-z_t\\right)
    
    """
    
    
    from math import sin, cos
    
    neig = len(m)
    nlayers = len(zt)
    
    A = np.zeros([neig, neig], float)        
    for layer in range(nlayers):
        for i in range(neig):
            A[i, i] += -(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zb[layer])**2 + (4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zt[layer])**2 + (4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zb[layer])**2 - (4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zt[layer])**2 - 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 - 2*zb[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*sin(m[i]*zb[layer])**2 + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])**2 - 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*sin(m[i]*zt[layer])**2 - 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])**2 + 2*zt[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 2*zt[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*sin(m[i]*zb[layer])**2 - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])**2 + 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*sin(m[i]*zt[layer])**2 + 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])**2
        for i in range(neig-1):
            for j in range(i + 1, neig):
                A[i, j] += m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zb[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zb[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zb[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zb[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zb[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zt[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zt[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer])                
                
    #A is symmetric
    for i in range(neig - 1):        
        for j in range(i + 1, neig):
            A[j, i] = A[i, j]                
    
    return A
    
    
def dim1sin_abf_linear(m, at, ab, bt, bb, zt, zb):
    """Create matrix of spectral integrations
    
    Performs integrations of `sin(mi * z) * a(z) *b(z) * sin(mj * z)` 
    between [0, 1] where a(z) and b(z) are piecewise linear functions of z.  
    Calulation of integrals is performed at each element of a square symmetric 
    matrix (size depends on size of `m`)
            
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer    
    bt : ``list`` of ``float``
        2nd property at top of each layer
    bb : ``list`` of ``float``
        2nd property at bottom of each layer 
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
             
    Returns
    -------
    A : numpy.ndarray
        returns a square symmetric matrix, size determined by size of `m`
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter
    geotecha.integrals_generate_code.dim1sin_abf_linear : use sympy 
    to perform the integrals symbolically and generate expressions for 
    this function
        
    Notes
    -----
    The `dim1sin_abf_linear` matrix, :math:`A` is given by:
        
    .. math:: \\mathbf{A}_{i,j}=\\int_{0}^1{{a\\left(z\\right)}{b\\left(z\\right)}\\phi_i\\phi_j\\,dz}
    
    where the basis function :math:`\\phi_i` is given by:
    
    
    ..math:: \\phi_i\\left(z\\right)=\\sin\\left({m_i}z\\right)
    
    and :math:`a\\left(z\\right)` and :math:`b\\left(z\\right)` are piecewise 
    linear functions w.r.t. :mathL`z`, that within a layer are defined by:
        
    ..math:: a\\left(z\\right) = a_t+\\frac{a_b-a_t}{z_b-z_t}\\left(z-z_t\\right)
    
    with :math:`t` and :math:`b` subscripts representing 'top' and 'bottom' of 
    each layer respectively.
    
    """
    
    
    from math import sin, cos
    
    neig = len(m)
    nlayers = len(zt)
    
    A = np.zeros([neig, neig], float)        
    for layer in range(nlayers):
        for i in range(neig):
            A[i, i] += 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])**2 + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])**2 + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])**2 + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])**2 + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])**2 + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])**2 + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])**2 - 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])**2 + 3*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])**2 - 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]**3*sin(m[i]*zb[layer])**2 + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]**3*cos(m[i]*zb[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]**3*sin(m[i]*zt[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]**3*cos(m[i]*zt[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**3*sin(m[i]*zb[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**3*cos(m[i]*zb[layer])**2 + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**3*sin(m[i]*zt[layer])**2 + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**3*cos(m[i]*zt[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**3*sin(m[i]*zb[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**3*cos(m[i]*zb[layer])**2 + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**3*sin(m[i]*zt[layer])**2 + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**3*cos(m[i]*zt[layer])**2 + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]**3*sin(m[i]*zb[layer])**2 + 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]**3*cos(m[i]*zb[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]**3*sin(m[i]*zt[layer])**2 - 2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]**3*cos(m[i]*zt[layer])**2 - 3*zb[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])**2 + 3*zb[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])**2 - 3*zb[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])**2 + 3*zb[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])**2 + 6*zb[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])**2 - 6*zb[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])**2 - 6*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 6*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 12*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 12*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 + 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 - 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 + 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 + 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 - 3*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 - 6*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 - 6*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 + 6*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 + 6*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 - 6*zb[layer]**2*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*zb[layer]**2*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 6*zb[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])**2 + 6*zb[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])**2 - 6*zb[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])**2 - 6*zb[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])**2 + 6*zt[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])**2 - 6*zt[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])**2 - 3*zt[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])**2 + 3*zt[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])**2 - 3*zt[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])**2 + 3*zt[layer]*m[i]*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])**2 + 12*zt[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 12*zt[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 6*zt[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*zt[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 6*zt[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*zt[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 6*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 - 6*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 + 6*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 + 6*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 + 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 + 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 - 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 + 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 + 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 - 3*zt[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 + 6*zt[layer]*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 6*zt[layer]*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 6*zt[layer]*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 6*zt[layer]*zb[layer]*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])**2 - 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])**2 + 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])**2 + 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])**2 - 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])**2 - 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])**2 + 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])**2 + 6*zt[layer]*zb[layer]*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])**2 - 6*zt[layer]**2*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 6*zt[layer]**2*m[i]**2*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 6*zt[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])**2 + 6*zt[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])**2 - 6*zt[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])**2 - 6*zt[layer]**2*m[i]**3*(12*zb[layer]**2*m[i]**3 - 24*zt[layer]*zb[layer]*m[i]**3 + 12*zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])**2
        for i in range(neig-1):
            for j in range(i + 1, neig):
                A[i, j] += 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 6*m[j]*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 4*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 6*m[j]**2*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*m[j]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 4*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zb[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zb[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zb[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zb[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*zb[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*zb[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zb[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 2*zb[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 2*zb[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 2*zb[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 4*zb[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 4*zb[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 4*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 4*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*zb[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 2*zb[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*zb[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 2*zb[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 4*zb[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 4*zb[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 4*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 4*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zb[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zb[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zb[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zb[layer]**2*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]**2*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zb[layer]**2*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]**2*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*zb[layer]**2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zb[layer]**2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*zb[layer]**2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]**2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zb[layer]**2*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]**2*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zb[layer]**2*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]**2*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*zt[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*zt[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zt[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zt[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 4*zt[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 4*zt[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 2*zt[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 2*zt[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 2*zt[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 2*zt[layer]*m[j]*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*zt[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zt[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 4*zt[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 4*zt[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zt[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zt[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zt[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zt[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 4*zt[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 4*zt[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*zt[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 2*zt[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*zt[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + 2*zt[layer]*m[j]**3*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + 4*zt[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 4*zt[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*zt[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zt[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*zt[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zt[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*zt[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zt[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[j]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zt[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zt[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*zt[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zt[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]*zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*zb[layer]*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zt[layer]*zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zt[layer]*zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zt[layer]*zb[layer]*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - 2*zt[layer]*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*zt[layer]*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*zt[layer]*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*zt[layer]*zb[layer]*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*zt[layer]*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*zt[layer]*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]*zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*zb[layer]*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zt[layer]*zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zt[layer]*zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zt[layer]*zb[layer]*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bt[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zt[layer]**2*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]**2*m[i]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]**2*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]**2*m[j]*m[i]**4*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*zt[layer]**2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*zt[layer]**2*m[j]**2*m[i]**3*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*zt[layer]**2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*zt[layer]**2*m[j]**3*m[i]**2*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zt[layer]**2*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]**2*m[j]**4*m[i]*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]**2*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]**2*m[j]**5*(zb[layer]**2*m[i]**6 - 3*zb[layer]**2*m[j]**2*m[i]**4 + 3*zb[layer]**2*m[j]**4*m[i]**2 - zb[layer]**2*m[j]**6 - 2*zt[layer]*zb[layer]*m[i]**6 + 6*zt[layer]*zb[layer]*m[j]**2*m[i]**4 - 6*zt[layer]*zb[layer]*m[j]**4*m[i]**2 + 2*zt[layer]*zb[layer]*m[j]**6 + zt[layer]**2*m[i]**6 - 3*zt[layer]**2*m[j]**2*m[i]**4 + 3*zt[layer]**2*m[j]**4*m[i]**2 - zt[layer]**2*m[j]**6)**(-1)*bb[layer]*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer])                
                
    #A is symmetric
    for i in range(neig - 1):        
        for j in range(i + 1, neig):
            A[j, i] = A[i, j]                
    
    return A    
    
    
    
def dim1sin_D_aDf_linear(m, at, ab, zt, zb):
    """Generate code to calculate spectral method integrations
    
    Performs integrations of `sin(mi * z) * D[a(z) * D[sin(mj * z),z],z]` 
    between [0, 1] where a(z) i piecewise linear functions of z.  
    Calulation of integrals is performed at each element of a square symmetric 
    matrix (size depends on size of `m`)
            
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer       
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
             
    Returns
    -------
    A : numpy.ndarray
        returns a square symmetric matrix, size determined by size of `m`
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter
    geotecha.speccon.integrals_generate_code.dim1sin_abf_linear : sympy
    integrations to produce the code to this function.
    
    Notes
    -----    
    The `dim1sin_D_aDf_linear` matrix, :math:`A` is given by:
    
    .. math:: \\mathbf{A}_{i,j}=\\int_{0}^1{\\frac{d}{dz}\\left({a\\left(z\\right)}\\frac{d\\phi_j}{dz}\\right)\\phi_i\\,dz}
    
    where the basis function :math:`\\phi_i` is given by:    
    
    ..math:: \\phi_i\\left(z\\right)=\\sin\\left({m_i}z\\right)
    
    and :math:`a\\left(z\\right)` and :math:`b\\left(z\\right)` are piecewise 
    linear functions w.r.t. :math:`z`, that within a layer are defined by:
        
    ..math:: a\\left(z\\right) = a_t+\\frac{a_b-a_t}{z_b-z_t}\\left(z-z_t\\right)
    
    with :math:`t` and :math:`b` subscripts representing 'top' and 'bottom' of 
    each layer respectively."""
        
    from math import sin, cos
    
    neig = len(m)
    nlayers = len(zt)
    
    A = np.zeros([neig, neig], float)        
    for layer in range(nlayers):
        for i in range(neig):
            A[i, i] += (zb[layer] - zt[layer])**(-1)*(ab[layer] - at[layer])*sin(m[i]*zb[layer])**2/2 - (zb[layer] - zt[layer])**(-1)*(ab[layer] - at[layer])*sin(m[i]*zt[layer])**2/2 - m[i]*((zb[layer] - zt[layer])**(-1)*(ab[layer] - at[layer])*(zb[layer] - zt[layer]) + at[layer])*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + m[i]*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - m[i]**2*(-(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zb[layer])**2 + (4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zb[layer])**2 - 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - 2*zb[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*sin(m[i]*zb[layer])**2 + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])**2 + 2*zt[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*sin(m[i]*zb[layer])**2 - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])**2) + m[i]**2*(-(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zt[layer])**2 + (4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zt[layer])**2 - 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 - 2*zb[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*sin(m[i]*zt[layer])**2 + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])**2 + 2*zt[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*sin(m[i]*zt[layer])**2 - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])**2)
        for i in range(neig-1):
            for j in range(i + 1, neig):
                A[i, j] += (zb[layer] - zt[layer])**(-1)*m[j]*(ab[layer] - at[layer])*(-m[i]*(m[i]**2 - m[j]**2)**(-1)*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - m[j]*(m[i]**2 - m[j]**2)**(-1)*sin(m[i]*zb[layer])*sin(m[j]*zb[layer])) - (zb[layer] - zt[layer])**(-1)*m[j]*(ab[layer] - at[layer])*(-m[i]*(m[i]**2 - m[j]**2)**(-1)*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - m[j]*(m[i]**2 - m[j]**2)**(-1)*sin(m[i]*zt[layer])*sin(m[j]*zt[layer])) - m[j]*((zb[layer] - zt[layer])**(-1)*(ab[layer] - at[layer])*(zb[layer] - zt[layer]) + at[layer])*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[j]**2*(m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zb[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zb[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zt[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer])) + m[j]**2*(m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zb[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zb[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zb[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zt[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]))                
                
    #A is symmetric
    for i in range(neig - 1):        
        for j in range(i + 1, neig):
            A[j, i] = A[i, j]                
    
    return A
    
def dim1sin_D_aDf_linear_v2(m, at, ab, zt, zb):
    """Generate code to calculate spectral method integrations
    
    Performs integrations of `sin(mi * z) * D[a(z) * D[sin(mj * z),z],z]` 
    between [0, 1] where a(z) i piecewise linear functions of z.  
    Calulation of integrals is performed at each element of a square symmetric 
    matrix (size depends on size of `m`)
            
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer       
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
             
    Returns
    -------
    A : numpy.ndarray
        returns a square symmetric matrix, size determined by size of `m`
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter
    geotecha.speccon.integrals_generate_code.dim1sin_abf_linear : sympy
    integrations to produce the code to this function.
    
    Notes
    -----    
    The `dim1sin_D_aDf_linear` matrix, :math:`A` is given by:
    
    .. math:: \\mathbf{A}_{i,j}=\\int_{0}^1{\\frac{d}{dz}\\left({a\\left(z\\right)}\\frac{d\\phi_j}{dz}\\right)\\phi_i\\,dz}
    
    where the basis function :math:`\\phi_i` is given by:    
    
    ..math:: \\phi_i\\left(z\\right)=\\sin\\left({m_i}z\\right)
    
    and :math:`a\\left(z\\right)` and :math:`b\\left(z\\right)` are piecewise 
    linear functions w.r.t. :math:`z`, that within a layer are defined by:
        
    ..math:: a\\left(z\\right) = a_t+\\frac{a_b-a_t}{z_b-z_t}\\left(z-z_t\\right)
    
    with :math:`t` and :math:`b` subscripts representing 'top' and 'bottom' of 
    each layer respectively."""
        
    from math import sin, cos
    
    from math import sin, cos
    
    neig = len(m)
    nlayers = len(zt)
    
    A = np.zeros([neig, neig], float)        
    for layer in range(nlayers):
        for i in range(neig):
            A[i, i] += -m[i]**2*((4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zb[layer])**2 - (4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zb[layer])**2 + 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]**2*sin(m[i]*zb[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]**2*cos(m[i]*zb[layer])**2 + 2*zb[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*sin(m[i]*zb[layer])**2 + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])**2 - 2*zt[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[i]*zb[layer]) - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*sin(m[i]*zb[layer])**2 - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])**2) + m[i]**2*((4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zt[layer])**2 - (4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zt[layer])**2 + 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 2*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 + m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]**2*sin(m[i]*zt[layer])**2 - m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]**2*cos(m[i]*zt[layer])**2 + 2*zb[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*sin(m[i]*zt[layer])**2 + 2*zb[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])**2 - 2*zt[layer]*m[i]*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[i]*zt[layer]) - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*sin(m[i]*zt[layer])**2 - 2*zt[layer]*m[i]**2*(4*zb[layer]*m[i]**2 - 4*zt[layer]*m[i]**2)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])**2)
        for i in range(neig-1):
            for j in range(i + 1, neig):
                A[i, j] += -m[j]*m[i]*(m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) + m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*cos(m[j]*zb[layer]) - m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zb[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zb[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zb[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zb[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zb[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) - zt[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) + zt[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer]) + zt[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zb[layer])*sin(m[i]*zb[layer]) - zt[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zb[layer])*sin(m[j]*zb[layer])) + m[j]*m[i]*(m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) + m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - 2*m[j]*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*sin(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - m[j]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*cos(m[j]*zt[layer]) - m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*zt[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zb[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zb[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zb[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zb[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*at[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) - zt[layer]*m[i]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) + zt[layer]*m[j]*m[i]**2*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]) + zt[layer]*m[j]**2*m[i]*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[j]*zt[layer])*sin(m[i]*zt[layer]) - zt[layer]*m[j]**3*(zb[layer]*m[i]**4 - 2*zb[layer]*m[j]**2*m[i]**2 + zb[layer]*m[j]**4 - zt[layer]*m[i]**4 + 2*zt[layer]*m[j]**2*m[i]**2 - zt[layer]*m[j]**4)**(-1)*ab[layer]*cos(m[i]*zt[layer])*sin(m[j]*zt[layer]))                
                
    #A is symmetric
    for i in range(neig - 1):        
        for j in range(i + 1, neig):
            A[j, i] = A[i, j]                
    
    return A
def dim1sin_ab_linear(m, at, ab, bt, bb, zt, zb):
    """Create matrix of spectral integrations
    
    Performs integrations of `sin(mi * z) * a(z) *b(z)` 
    between [0, 1] where a(z) and b(z) are piecewise linear functions of z.  
    Calulation of integrals is performed at each element of a 1d array
    (size depends on size of `m`)
            
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer    
    bt : ``list`` of ``float``
        2nd property at top of each layer
    bb : ``list`` of ``float``
        2nd property at bottom of each layer 
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
             
    Returns
    -------
    A : numpy.ndarray
        returns a 1d array size determined by size of `m`. treat as column 
        vector
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter
    geotecha.integrals_generate_code.dim1sin_ab_linear : use sympy 
    to perform the integrals symbolically and generate expressions for 
    this function    
    
    Notes
    -----    
    The `dim1sin_ab_linear` which should be treated as a column vector, 
    :math:`A` is given by:    
        
    .. math:: \\mathbf{A}_{i}=\\int_{0}^1{{a\\left(z\\right)}{b\\left(z\\right)}\\phi_i\\,dz}
    
    where the basis function :math:`\\phi_i` is given by:    
    
    ..math:: \\phi_i\\left(z\\right)=\\sin\\left({m_i}z\\right)
    
    and :math:`a\\left(z\\right)` and :math:`b\\left(z\\right)` are piecewise 
    linear functions w.r.t. :math:`z`, that within a layer are defined by:
        
    ..math:: a\\left(z\\right) = a_t+\\frac{a_b-a_t}{z_b-z_t}\\left(z-z_t\\right)
    
    with :math:`t` and :math:`b` subscripts representing 'top' and 'bottom' of 
    each layer respectively.
    
    """
    
    
    from math import sin, cos
    
    neig = len(m)
    nlayers = len(zt)
    
    A = np.zeros(neig, float)        
    for layer in range(nlayers):
        for i in range(neig):
            A[i] += 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer]) - 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer]) - 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer]) + 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer]) - 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) + 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) + 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer]) - 2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer]) + 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) - 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) - 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) + 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) - 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) + 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) + 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) - 2*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) - m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + zb[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*sin(m[i]*zb[layer]) - zb[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*sin(m[i]*zt[layer]) + zb[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) - zb[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) - 2*zb[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*sin(m[i]*zb[layer]) + 2*zb[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*sin(m[i]*zt[layer]) - zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) + zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) - 2*zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - zb[layer]**2*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zb[layer]) + zb[layer]**2*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*at[layer]*cos(m[i]*zt[layer]) - 2*zt[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*sin(m[i]*zb[layer]) + 2*zt[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*sin(m[i]*zt[layer]) + zt[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*sin(m[i]*zb[layer]) - zt[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*sin(m[i]*zt[layer]) + zt[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) - zt[layer]*m[i]*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) + 2*zt[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) - 2*zt[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) - zt[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + zt[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - zt[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) + zt[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + zt[layer]*zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zb[layer]) - zt[layer]*zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*at[layer]*cos(m[i]*zt[layer]) + zt[layer]*zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) - zt[layer]*zb[layer]*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) - zt[layer]**2*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zb[layer]) + zt[layer]**2*m[i]**2*(zb[layer]**2*m[i]**3 - 2*zt[layer]*zb[layer]*m[i]**3 + zt[layer]**2*m[i]**3)**(-1)*bb[layer]*ab[layer]*cos(m[i]*zt[layer])
    
    return A

def dim1sin_abc_linear(m, at, ab, bt, bb, ct, cb, zt, zb):
    """Create matrix of spectral integrations
    
    Performs integrations of `sin(mi * z) * a(z) * b(z) * c(z)` 
    between [0, 1] where a(z), b(z), c(z) are piecewise linear functions of z.  
    Calulation of integrals is performed at each element of a 1d array
    (size depends on size of `m`)
            
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer    
    bt : ``list`` of ``float``
        2nd property at top of each layer
    bb : ``list`` of ``float``
        2nd property at bottom of each layer
    ct : ``list`` of ``float``
        3rd property at top of each layer
    cb : ``list`` of ``float``
        3rd property at bottom of each layer         
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
             
    Returns
    -------
    A : numpy.ndarray
        returns a 1d array size determined by size of `m`. treat as column 
        vector
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter
    geotecha.integrals_generate_code.dim1sin_abc_linear : use sympy 
    to perform the integrals symbolically and generate expressions for 
    this function    
    
    Notes
    -----    
    The `dim1sin_abc_linear` which should be treated as a column vector, 
    :math:`A` is given by:    
        
    .. math:: \\mathbf{A}_{i}=\\int_{0}^1{{a\\left(z\\right)}{b\\left(z\\right)}{c\\left(z\\right)}\\phi_i\\,dz}
    
    where the basis function :math:`\\phi_i` is given by:    
    
    ..math:: \\phi_i\\left(z\\right)=\\sin\\left({m_i}z\\right)
    
    and :math:`a\\left(z\\right)`, :math:`b\\left(z\\right)`, and 
    :math:`c\\left(z\\right)` are piecewise linear functions 
    w.r.t. :math:`z`, that within a layer are defined by:
        
    ..math:: a\\left(z\\right) = a_t+\\frac{a_b-a_t}{z_b-z_t}\\left(z-z_t\\right)
    
    with :math:`t` and :math:`b` subscripts representing 'top' and 'bottom' of 
    each layer respectively.
    
    """
    
    
    from math import sin, cos
    
    neig = len(m)
    nlayers = len(zt)
    
    A = np.zeros(neig, float)        
    for layer in range(nlayers):
        for i in range(neig):
            A[i] += -6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*sin(m[i]*zb[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*sin(m[i]*zt[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*sin(m[i]*zb[layer]) - 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*sin(m[i]*zt[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) - 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) - 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*sin(m[i]*zb[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*sin(m[i]*zt[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*sin(m[i]*zb[layer]) - 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*sin(m[i]*zt[layer]) - 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*sin(m[i]*zb[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*sin(m[i]*zt[layer]) - 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) + 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*sin(m[i]*zb[layer]) - 6*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*sin(m[i]*zt[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) - 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + 6*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]**2*sin(m[i]*zb[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]**2*sin(m[i]*zt[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]**2*sin(m[i]*zb[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]**2*sin(m[i]*zt[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]**2*sin(m[i]*zb[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]**2*sin(m[i]*zt[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]**2*sin(m[i]*zb[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]**2*sin(m[i]*zt[layer]) - 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zb[layer]**2*sin(m[i]*zb[layer]) + 3*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zt[layer]**2*sin(m[i]*zt[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zb[layer]**3*cos(m[i]*zb[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zt[layer]**3*cos(m[i]*zt[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]**3*cos(m[i]*zb[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]**3*cos(m[i]*zt[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]**3*cos(m[i]*zb[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]**3*cos(m[i]*zt[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]**3*cos(m[i]*zb[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]**3*cos(m[i]*zt[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]**3*cos(m[i]*zb[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]**3*cos(m[i]*zt[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]**3*cos(m[i]*zb[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]**3*cos(m[i]*zt[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]**3*cos(m[i]*zb[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]**3*cos(m[i]*zt[layer]) + m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zb[layer]**3*cos(m[i]*zb[layer]) - m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zt[layer]**3*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*cos(m[i]*zb[layer]) - 2*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) - 2*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) - 4*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*cos(m[i]*zb[layer]) + 4*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*cos(m[i]*zb[layer]) - 2*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*cos(m[i]*zt[layer]) - 4*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*cos(m[i]*zb[layer]) + 4*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*cos(m[i]*zt[layer]) - 4*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) + 4*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) + 6*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*cos(m[i]*zb[layer]) - 6*zb[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) - 2*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) + 2*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) - 2*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) - 4*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) + 4*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) + 2*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) - 2*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) - 4*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) + 4*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) - 4*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) + 4*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) + 6*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) - 6*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) - zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - 2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - 2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + 2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - 2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - 3*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + 3*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*sin(m[i]*zb[layer]) - zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*sin(m[i]*zt[layer]) + zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*sin(m[i]*zb[layer]) - zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*sin(m[i]*zt[layer]) + zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) - zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) - 3*zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*sin(m[i]*zb[layer]) + 3*zb[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*sin(m[i]*zt[layer]) - zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) + zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + 3*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) - 3*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - zb[layer]**3*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*cos(m[i]*zb[layer]) + zb[layer]**3*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*at[layer]*cos(m[i]*zt[layer]) - 6*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*cos(m[i]*zb[layer]) + 6*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*cos(m[i]*zt[layer]) + 4*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*cos(m[i]*zb[layer]) - 4*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*cos(m[i]*zt[layer]) + 4*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) - 4*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) - 2*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*cos(m[i]*zb[layer]) + 2*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*cos(m[i]*zt[layer]) + 4*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*cos(m[i]*zb[layer]) - 4*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*cos(m[i]*zt[layer]) - 2*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*cos(m[i]*zb[layer]) + 2*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*cos(m[i]*zt[layer]) - 2*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) + 2*zt[layer]*m[i]*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) - 6*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) + 6*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) + 4*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) - 4*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) + 4*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) - 4*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) - 2*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) + 2*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) + 4*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) - 4*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) - 2*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]*sin(m[i]*zb[layer]) + 2*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]*sin(m[i]*zt[layer]) - 2*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]*sin(m[i]*zb[layer]) + 2*zt[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]*sin(m[i]*zt[layer]) + 3*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - 3*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - 2*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + 2*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - 2*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + 2*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - 2*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) + 2*zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]**2*cos(m[i]*zt[layer]) + zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]**2*cos(m[i]*zb[layer]) - zt[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]**2*cos(m[i]*zt[layer]) - 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*sin(m[i]*zb[layer]) + 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*sin(m[i]*zt[layer]) - 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) + 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) + 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*sin(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*sin(m[i]*zt[layer]) - 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*sin(m[i]*zb[layer]) + 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*sin(m[i]*zt[layer]) + 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*sin(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*sin(m[i]*zt[layer]) + 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) + 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) + 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) - 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) + 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) - 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) - 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) + 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) - 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) + 2*zt[layer]*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + zt[layer]*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*cos(m[i]*zb[layer]) - zt[layer]*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*at[layer]*cos(m[i]*zt[layer]) + zt[layer]*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*cos(m[i]*zb[layer]) - zt[layer]*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*at[layer]*cos(m[i]*zt[layer]) + zt[layer]*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) - zt[layer]*zb[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) + 3*zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*sin(m[i]*zb[layer]) - 3*zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*sin(m[i]*zt[layer]) - zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*sin(m[i]*zb[layer]) + zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*sin(m[i]*zt[layer]) - zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*sin(m[i]*zb[layer]) + zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*sin(m[i]*zt[layer]) - zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*sin(m[i]*zb[layer]) + zt[layer]**2*m[i]**2*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*sin(m[i]*zt[layer]) - 3*zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) + 3*zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zb[layer]*cos(m[i]*zb[layer]) - zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*zt[layer]*cos(m[i]*zt[layer]) + zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) - zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) + zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zb[layer]*cos(m[i]*zb[layer]) - zt[layer]**2*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*zt[layer]*cos(m[i]*zt[layer]) - zt[layer]**2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*cos(m[i]*zb[layer]) + zt[layer]**2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*at[layer]*cos(m[i]*zt[layer]) - zt[layer]**2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*cos(m[i]*zb[layer]) + zt[layer]**2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bt[layer]*ab[layer]*cos(m[i]*zt[layer]) - zt[layer]**2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*cos(m[i]*zb[layer]) + zt[layer]**2*zb[layer]*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*ct[layer]*bb[layer]*ab[layer]*cos(m[i]*zt[layer]) + zt[layer]**3*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*cos(m[i]*zb[layer]) - zt[layer]**3*m[i]**3*(zb[layer]**3*m[i]**4 - 3*zt[layer]*zb[layer]**2*m[i]**4 + 3*zt[layer]**2*zb[layer]*m[i]**4 - zt[layer]**3*m[i]**4)**(-1)*cb[layer]*bb[layer]*ab[layer]*cos(m[i]*zt[layer])
    
    return A

def dim1sin_D_aDb_linear(m, at, ab, bt, bb, zt, zb):
    """Create matrix of spectral integrations
    
    Performs integrations of `sin(mi * z) * D[a(z) * D[b(z), z], z]` 
    between [0, 1] where a(z) and b(z) are piecewise linear functions of z.  
    Calulation of integrals is performed at each element of a 1d array
    (size depends on size of `m`)
            
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer    
    bt : ``list`` of ``float``
        2nd property at top of each layer
    bb : ``list`` of ``float``
        2nd property at bottom of each layer 
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
             
    Returns
    -------
    A : numpy.ndarray
        returns a 1d array size determined by size of `m`. treat as column 
        vector
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter
    geotecha.integrals_generate_code.dim1sin_D_aDb_linear : use sympy 
    to perform the integrals symbolically and generate expressions for 
    this function    
    
    Notes
    -----    
    The `dim1sin_D_aDb_linear` which should be treated as a column vector, 
    :math:`A` is given by:    
        
    .. math:: \\mathbf{A}_{i,j}=\\int_{0}^1{\\frac{d}{dz}\\left({a\\left(z\\right)}\\frac{d}{dz}{b\\left(z\\right)}\\right)\\phi_i\\,dz}
    
    where the basis function :math:`\\phi_i` is given by:    
    
    ..math:: \\phi_i\\left(z\\right)=\\sin\\left({m_i}z\\right)
    
    and :math:`a\\left(z\\right)` and :math:`b\\left(z\\right)` are piecewise 
    linear functions w.r.t. :math:`z`, that within a layer are defined by:
        
    ..math:: a\\left(z\\right) = a_t+\\frac{a_b-a_t}{z_b-z_t}\\left(z-z_t\\right)
    
    with :math:`t` and :math:`b` subscripts representing 'top' and 'bottom' of 
    each layer respectively.
    
    """
    
    
    from math import sin, cos
    
    neig = len(m)
    nlayers = len(zt)
    
    A = np.zeros(neig, float)        
    for layer in range(nlayers):
        for i in range(neig):
            A[i] += -(zb[layer] - zt[layer])**(-2)*m[i]**(-1)*(bb[layer] - bt[layer])*(ab[layer] - at[layer])*cos(m[i]*zb[layer]) + (zb[layer] - zt[layer])**(-2)*m[i]**(-1)*(bb[layer] - bt[layer])*(ab[layer] - at[layer])*cos(m[i]*zt[layer]) - (zb[layer] - zt[layer])**(-1)*(bb[layer] - bt[layer])*((zb[layer] - zt[layer])**(-1)*(ab[layer] - at[layer])*(zb[layer] - zt[layer]) + at[layer])*sin(m[i]*zb[layer]) + (zb[layer] - zt[layer])**(-1)*(bb[layer] - bt[layer])*at[layer]*sin(m[i]*zt[layer])
    
    for i in range(neig):
        A[i] += -(zb[0] - zt[0])**(-1)*(bb[0] - bt[0])*at[0]*sin(m[i]*zt[0]) + (zb[-1] - zt[-1])**(-1)*(bb[-1] - bt[-1])*((zb[-1] - zt[-1])**(-1)*(ab[-1] - at[-1])*(zb[-1] - zt[-1]) + at[-1])*sin(m[i]*zb[-1])
    
    return A       
    
    
    
    

def EDload_linear(loadtim, loadmag, eigs, tvals, dT=1.0):
    """Generate code to perform time integration for spectral methods
    
    Integrates D[load(tau), tau] * exp(dT * eig * (t-tau)) between [0, t].
    Performs integrations involving time and the time derivative of a 
    piecewise linear load.  A 2d array of dimesnions A[len(tvals), len(eigs)] 
    is produced where the 'i'th row of A contains the diagonal elements of the 
    spectral 'E' matrix calculated for the time value tvals[i]. i.e. rows of 
    this matrix will be assembled into the diagonal matrix 'E' elsewhere.
    
    
    Parameters
    ----------
    loadtim : 1d numpy.ndarray
        list of times describing load application
    loadmag : 1d numpy.ndarray
        list of load magnitudes        
    eigs : 1d numpy.ndarray
        list of eigenvalues
    tvals : 1d numpy.ndarray`
        list of time values to calculate integral at
    dT : ``float``, optional
        time factor multiple (default = 1.0)
    
    Returns
    -------
    A : numpy.ndarray
        returns a 2d array of dimesnions A[len(tvals), len(eigs)].  
        The 'i'th row of A is the diagonal elements of the spectral 'E' matrix 
        calculated for the time tvals[i].
        vector

    Notes
    -----
    
    TODO: equations etc.
    
    """
    
    
    from math import exp
    
    loadtim = np.asarray(loadtim)
    loadmag = np.asarray(loadmag)
    eigs = np.asarray(eigs)
    tvals = np.asarray(tvals)
    
    
    (ramps_less_than_t, constants_less_than_t, steps_less_than_t, 
            ramps_containing_t, constants_containing_t) = segment_containing_also_segments_less_than_xi(loadtim, loadmag, tvals, steps_or_equal_to = True)
        
           
    A = np.zeros([len(tvals), len(eigs)])
    
        
    for i, t in enumerate(tvals):
        for k in steps_less_than_t[i]:    
            for j, eig in enumerate(eigs):
                A[i,j] += (loadmag[k + 1] - loadmag[k])*exp(-dT*eig*(t - loadtim[k])) 
        for k in ramps_containing_t[i]:
            for j, eig in enumerate(eigs):
                A[i,j] += (loadmag[k + 1] - loadmag[k])*(loadtim[k + 1] - loadtim[k])**(-1)/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))*(loadmag[k + 1] - loadmag[k])*(loadtim[k + 1] - loadtim[k])**(-1)/(dT*eig) 
        for k in ramps_less_than_t[i]:
            for j, eig in enumerate(eigs):
                A[i,j] += exp(-dT*eig*(t - loadtim[k + 1]))*(loadmag[k + 1] - loadmag[k])*(loadtim[k + 1] - loadtim[k])**(-1)/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))*(loadmag[k + 1] - loadmag[k])*(loadtim[k + 1] - loadtim[k])**(-1)/(dT*eig)
    return A    
    
def Eload_linear(loadtim, loadmag, eigs, tvals, dT=1.0):
    """Generate code to perform time integration for spectral methods
    
    Integrates load(tau) * exp(dT * eig * (t-tau)) between [0, t].
    Performs integrations involving time and the time derivative of a 
    piecewise linear load.  A 2d array of dimensions A[len(tvals), len(eigs)] 
    is produced where the 'i'th row of A contains the diagonal elements of the 
    spectral 'E' matrix calculated for the time value tvals[i]. i.e. rows of 
    this matrix will be assembled into the diagonal matrix 'E' elsewhere.
    
    
    Parameters
    ----------
    loadtim : 1d numpy.ndarray
        list of times describing load application
    loadmag : 1d numpy.ndarray
        list of load magnitudes        
    eigs : 1d numpy.ndarray
        list of eigenvalues
    tvals : 1d numpy.ndarray`
        list of time values to calculate integral at
    dT : ``float``, optional
        time factor multiple (default = 1.0)
    
    Returns
    -------
    A : numpy.ndarray
        returns a 2d array of dimesnions A[len(tvals), len(eigs)].  
        The 'i'th row of A is the diagonal elements of the spectral 'E' matrix 
        calculated for the time tvals[i].
        vector

    Notes
    -----
    
    TODO: equations etc.
    
    """
    
    from math import exp
    
    loadtim = np.asarray(loadtim)
    loadmag = np.asarray(loadmag)
    eigs = np.asarray(eigs)
    tvals = np.asarray(tvals)    

    (ramps_less_than_t, constants_less_than_t, steps_less_than_t, 
            ramps_containing_t, constants_containing_t) = segment_containing_also_segments_less_than_xi(loadtim, loadmag, tvals, steps_or_equal_to = True)
           
    A = np.zeros([len(tvals), len(eigs)])
    
        
    for i, t in enumerate(tvals):
        for k in constants_containing_t[i]:    
            for j, eig in enumerate(eigs):
                A[i,j] += -exp(-dT*eig*(t - loadtim[k]))*loadmag[k]/(dT*eig) + loadmag[k]/(dT*eig)
        for k in constants_less_than_t[i]:    
            for j, eig in enumerate(eigs):
                A[i,j] += exp(-dT*eig*(t - loadtim[k + 1]))*loadmag[k]/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))*loadmag[k]/(dT*eig) 
        for k in ramps_containing_t[i]:
            for j, eig in enumerate(eigs):
                A[i,j] += (-t/(dT*eig) + 1/(dT**2*eig**2))*loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1) + (t/(dT*eig) - 1/(dT**2*eig**2))*loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1) - (-loadtim[k]*exp(-dT*eig*(t - loadtim[k]))/(dT*eig) + exp(-dT*eig*(t - loadtim[k]))/(dT**2*eig**2))*loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1) - (loadtim[k]*exp(-dT*eig*(t - loadtim[k]))/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))/(dT**2*eig**2))*loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1) + exp(-dT*eig*(t - loadtim[k]))*loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))*loadmag[k]/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))*loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig) - loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig) + loadmag[k]/(dT*eig) + loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig) 
        for k in ramps_less_than_t[i]:
            for j, eig in enumerate(eigs):
                A[i,j] += (-loadtim[k + 1]*exp(-dT*eig*(t - loadtim[k + 1]))/(dT*eig) + exp(-dT*eig*(t - loadtim[k + 1]))/(dT**2*eig**2))*loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1) + (loadtim[k + 1]*exp(-dT*eig*(t - loadtim[k + 1]))/(dT*eig) - exp(-dT*eig*(t - loadtim[k + 1]))/(dT**2*eig**2))*loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1) - (-loadtim[k]*exp(-dT*eig*(t - loadtim[k]))/(dT*eig) + exp(-dT*eig*(t - loadtim[k]))/(dT**2*eig**2))*loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1) - (loadtim[k]*exp(-dT*eig*(t - loadtim[k]))/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))/(dT**2*eig**2))*loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1) - exp(-dT*eig*(t - loadtim[k + 1]))*loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig) + exp(-dT*eig*(t - loadtim[k + 1]))*loadmag[k]/(dT*eig) + exp(-dT*eig*(t - loadtim[k + 1]))*loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig) + exp(-dT*eig*(t - loadtim[k]))*loadmag[k + 1]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))*loadmag[k]/(dT*eig) - exp(-dT*eig*(t - loadtim[k]))*loadmag[k]*(loadtim[k + 1] - loadtim[k])**(-1)*loadtim[k]/(dT*eig)
    return A
    
    
def dim1sin(m, z):
    """calc sin(m*z) for each combination of m and z
    
    calculates array A[len(z), len(m)]
    
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx         
    z : ``list`` of ``float``
        normalised depth or z-coordinate should be between 0 and 1.
             
    Returns
    -------
    A : numpy.ndarray
        returns an array  1d array size A[len(z), len(m)]
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter        
    
    Notes
    -----    
    TODO:
        
    """
    
    m = np.asarray(m)
    z = np.asarray(z)
    
    return np.sin(z[:, np.newaxis]*m[np.newaxis, :])


def dim1sin_avg_between(m, z):
    """calc integrate(sin(m*z), (z, z1, z2))/(z2-z1) for each combination of m and [z1,z2]
    
    calculates array A[len(z), len(m)]
    
    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx         
    z : ``list`` of ``list`` of float``
        normalised depth or z-coordinate pair should be two values 
        between 0 and 1.
             
    Returns
    -------
    A : numpy.ndarray
        returns an array  1d array size A[len(z), len(m)]
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter        
    
    Notes
    -----    
    TODO:
        
    """
    
    from numpy import sin, cos
    m = np.asarray(m)
    z = np.asarray(z)
    
    a = z[:,0][:,np.newaxis]
    b = z[:,1][:,np.newaxis]
    mm = m[np.newaxis,:]
    
    return (cos(a*mm)-cos(b*mm))/mm/(b-a)

def dim1sin_a_linear_between(m, at, ab, zt, zb, z):
    """calc integrate(a(z) * sin(m*z), (z, z1, z2)) for each combination of m and [z1,z2]
    
    
    Performs integrations of `sin(mi * z) * a(z) *b(z)` 
    between [z1, z2] where a(z) is a piecewise linear functions of z.  
    calculates array A[len(z), len(m)]

    Parameters
    ----------
    m : ``list`` of ``float``
        eigenvlaues of BVP. generate with geoteca.speccon.m_from_sin_mx         
    at : ``list`` of ``float``
        property at top of each layer
    ab : ``list`` of ``float``
        property at bottom of each layer        
    zt : ``list`` of ``float``
        normalised depth or z-coordinate at top of each layer. `zt[0]` = 0
    zb : ``list`` of ``float``
        normalised depth or z-coordinate at bottom of each layer. `zt[-1]` = 1
    z : ``list`` of ``list`` of float``
        normalised depth or z-coordinate pair should be two values 
        between 0 and 1.
             
    Returns
    -------
    A : numpy.ndarray
        returns an array  1d array size A[len(z), len(m)]
        
    See Also
    --------
    m_from_sin_mx : used to generate 'm' input parameter        
    
    
    Notes
    -----    
    TODO:
        
    """
    
    
    from math import sin, cos
    m = np.asarray(m)
    
    z = np.atleast_2d(z)
#    if isinstance(z[0], numbers.Number):    
#        z = np.array([z])        
#    z = np.asarray(z)

    
    z1 = z[:,0]
    z2 = z[:,1]    
    
    z_for_interp = np.zeros(len(zt)+1)
    z_for_interp[:-1] = zt[:]
    z_for_interp[-1]=zb[-1]
    
    
    (segment_both, segment_z1_only, segment_z2_only, segments_between) = segments_between_xi_and_xj(z_for_interp,z1,z2)
        
    nz = len(z)
    neig = len(m)  
    
    A = np.zeros([nz,neig])      
    for i in range(nz):        
        for layer in segment_both[i]:
            for j in range(neig):
                A[i,j] += -(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*z1[i]) + (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*z2[i]) + (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*z1[i]) - (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*z2[i]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*z1[i]*cos(m[j]*z1[i]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*z2[i]*cos(m[j]*z2[i]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*z1[i]*cos(m[j]*z1[i]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*z2[i]*cos(m[j]*z2[i]) + zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*z1[i]) - zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*z2[i]) - zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*z1[i]) + zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*z2[i])
        for layer in segment_z1_only[i]:
            for j in range(neig):
                A[i,j] += -(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*z1[i]) + (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*zb[layer]) + (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*z1[i]) - (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*zb[layer]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*z1[i]*cos(m[j]*z1[i]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*z1[i]*cos(m[j]*z1[i]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer]) + zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*z1[i]) - zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*zb[layer]) - zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*z1[i]) + zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*zb[layer])
        for layer in segments_between[i]:
            for j in range(neig):
                A[i,j] += (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*zb[layer]) - (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*zt[layer]) - (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*zb[layer]) + (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*zt[layer]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*zb[layer]*cos(m[j]*zb[layer]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*zb[layer]*cos(m[j]*zb[layer]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer]) - zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*zb[layer]) + zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*zt[layer]) + zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*zb[layer]) - zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*zt[layer])
        for layer in segment_z2_only[i]:
            for j in range(neig):
                A[i,j] += (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*z2[i]) - (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*sin(m[j]*zt[layer]) - (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*z2[i]) + (zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*sin(m[j]*zt[layer]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*z2[i]*cos(m[j]*z2[i]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*zt[layer]*cos(m[j]*zt[layer]) + m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*z2[i]*cos(m[j]*z2[i]) - m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*zt[layer]*cos(m[j]*zt[layer]) - zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*z2[i]) + zb[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*at[layer]*cos(m[j]*zt[layer]) + zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*z2[i]) - zt[layer]*m[j]*(zb[layer]*m[j]**2 - zt[layer]*m[j]**2)**(-1)*ab[layer]*cos(m[j]*zt[layer])
    return A

    
if __name__=='__main__':
    eigs = np.array([2.46740110027, 22.2066099025])        
    dic = {'loadtim': np.array([0,0]), 'loadmag': np.array([0, 100]), 'eigs': eigs, 'tvals': np.array([-1,0,1])}
    #print(EDload_linear(**dic))
    #
    dic = {'loadtim': np.array([0,0,10]), 'loadmag': np.array([0, -100,-100]), 'eigs': eigs, 'tvals': np.array([-1,0,1])}
    #print (Eload_linear(**dic))
    
    
    import math
    dic = {'m': [ math.pi/2,  3 * math.pi/2], 'at':[1], 'ab':[1],'zt':[0], 'zb':[1], 'z': [[0, 1], [0.1, 0.2], [0.5, 1]]}
    print(dim1sin_a_linear_between(**dic))